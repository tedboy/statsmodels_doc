

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>statsmodels.emplike.aft_el &mdash; Statsmodels API v1</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Statsmodels API v1" href="../../../index.html"/>
        <link rel="up" title="statsmodels" href="../../statsmodels.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> Statsmodels API
          

          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../main_api.html">1. Main API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc_basic/index.html">2. Basic Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../main.html">3. Main modules of interest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../submain.html">4. Other modules of interest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sandbox.html">5. statsmodel.sandbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sandbox2.html">6. statsmodel.sandbox2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc/index.html">7. From official doc</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Statsmodels API</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../statsmodels.html">statsmodels</a> &raquo;</li>
        
      <li>statsmodels.emplike.aft_el</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for statsmodels.emplike.aft_el</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">Accelerated Failure Time (AFT) Model with empirical likelihood inference.</span>

<span class="sd">AFT regression analysis is applicable when the researcher has access</span>
<span class="sd">to a randomly right censored dependent variable, a matrix of exogenous</span>
<span class="sd">variables and an indicatior variable (delta) that takes a value of 0 if the</span>
<span class="sd">observation is censored and 1 otherwise.</span>

<span class="sd">AFT References</span>
<span class="sd">--------------</span>

<span class="sd">Stute, W. (1993). &quot;Consistent Estimation Under Random Censorship when</span>
<span class="sd">Covariables are Present.&quot; Journal of Multivariate Analysis.</span>
<span class="sd">Vol. 45. Iss. 1. 89-103</span>

<span class="sd">EL and AFT References</span>
<span class="sd">---------------------</span>

<span class="sd">Zhou, Kim And Bathke. &quot;Empirical Likelihood Analysis for the Heteroskedastic</span>
<span class="sd">Accelerated Failure Time Model.&quot; Manuscript:</span>
<span class="sd">URL: www.ms.uky.edu/~mai/research/CasewiseEL20080724.pdf</span>

<span class="sd">Zhou, M. (2005). Empirical Likelihood Ratio with Arbitrarily Censored/</span>
<span class="sd">Truncated Data by EM Algorithm.  Journal of Computational and Graphical</span>
<span class="sd">Statistics. 14:3, 643-656.</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.regression.linear_model</span> <span class="k">import</span> <span class="n">OLS</span><span class="p">,</span> <span class="n">WLS</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools</span> <span class="k">import</span> <span class="n">add_constant</span>
<span class="c1">#from elregress import ElReg</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="k">import</span> <span class="n">chi2</span>
<span class="kn">from</span> <span class="nn">.descriptive</span> <span class="k">import</span> <span class="n">_OptFuncts</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.sm_exceptions</span> <span class="k">import</span> <span class="n">IterationLimitWarning</span>

<div class="viewcode-block" id="OptAFT"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.aft_el.OptAFT.html#statsmodels.emplike.aft_el.OptAFT">[docs]</a><span class="k">class</span> <span class="nc">OptAFT</span><span class="p">(</span><span class="n">_OptFuncts</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provides optimization functions used in estimating and conducting</span>
<span class="sd">    inference in an AFT model.</span>

<span class="sd">    Methods</span>
<span class="sd">    ------</span>

<span class="sd">    _opt_wtd_nuis_regress:</span>
<span class="sd">        Function optimized over nuisance parameters to compute</span>
<span class="sd">        the profile likelihood</span>

<span class="sd">    _EM_test:</span>
<span class="sd">        Uses the modified Em algorithm of Zhou 2005 to maximize the</span>
<span class="sd">        likelihood of a parameter vector.</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="OptAFT.__init__"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.aft_el.OptAFT.__init__.html#statsmodels.emplike.aft_el.OptAFT.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">_opt_wtd_nuis_regress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A function that is optimized over nuisance parameters to conduct a</span>
<span class="sd">        hypothesis test for the parameters of interest</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        params: 1d array</span>
<span class="sd">            The regression coefficients of the model.  This includes the</span>
<span class="sd">            nuisance and parameters of interests.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        llr: float</span>
<span class="sd">            -2 times the log likelihood of the nuisance parameters and the</span>
<span class="sd">            hypothesized value of the parameter(s) of interest.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">test_params</span> <span class="o">=</span> <span class="n">test_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nvar</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">est_vect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">uncens_exog</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">uncens_endog</span> <span class="o">-</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">uncens_exog</span><span class="p">,</span>
                                                         <span class="n">test_params</span><span class="p">))</span>
        <span class="n">eta_star</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modif_newton</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nvar</span><span class="p">),</span> <span class="n">est_vect</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_fit_weights</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_fit_weights</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">eta_star</span><span class="p">,</span> <span class="n">est_vect</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_fit_weights</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_weights</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_EM_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuisance_params</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">param_nums</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">b0_vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">F</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">survidx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uncens_nobs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">numcensbelow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">km</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">uncensored</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">censored</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">maxiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses EM algorithm to compute the maximum likelihood of a test</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>

<span class="sd">        Nuisance Params: array</span>
<span class="sd">            Vector of values to be used as nuisance params.</span>

<span class="sd">        maxiter: int</span>
<span class="sd">            Number of iterations in the EM algorithm for a parameter vector</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        -2 &#39;&#39;*&#39;&#39; log likelihood ratio at hypothesized values and</span>
<span class="sd">        nuisance params</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Optional parameters are provided by the test_beta function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">iters</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">params</span><span class="p">[</span><span class="n">param_nums</span><span class="p">]</span> <span class="o">=</span> <span class="n">b0_vals</span>

        <span class="n">nuis_param_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nvar</span><span class="p">),</span>
                                           <span class="n">param_nums</span><span class="p">))</span>
        <span class="n">params</span><span class="p">[</span><span class="n">nuis_param_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuisance_params</span>
        <span class="n">to_test</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nvar</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">opt_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">while</span> <span class="n">iters</span> <span class="o">&lt;</span> <span class="n">maxiter</span> <span class="ow">and</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">ftol</span><span class="p">:</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">death</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">F</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">survivalprob</span> <span class="o">=</span> <span class="n">death</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">surv_point_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                <span class="mf">1.</span> <span class="o">/</span> <span class="n">survivalprob</span><span class="p">[</span><span class="n">survidx</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">surv_point_mat</span> <span class="o">=</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">surv_point_mat</span><span class="p">)</span>
            <span class="n">summed_wts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">surv_point_mat</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">wts</span> <span class="o">=</span> <span class="n">summed_wts</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">uncens_nobs</span><span class="p">)),</span>
                             <span class="n">numcensbelow</span><span class="p">[</span><span class="n">uncensored</span><span class="p">]]</span>
            <span class="c1"># ^E step</span>
            <span class="c1"># See Zhou 2005, section 3.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_fit_weights</span> <span class="o">=</span> <span class="n">wts</span>
            <span class="n">new_opt_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opt_wtd_nuis_regress</span><span class="p">(</span><span class="n">to_test</span><span class="p">)</span>
                <span class="c1"># ^ Uncensored weights&#39; contribution to likelihood value.</span>
            <span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_weights</span>
                <span class="c1"># ^ M step</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">new_opt_res</span> <span class="o">-</span> <span class="n">opt_res</span><span class="p">)</span>
            <span class="n">opt_res</span> <span class="o">=</span> <span class="n">new_opt_res</span>
            <span class="n">iters</span> <span class="o">=</span> <span class="n">iters</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">death</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">survivalprob</span> <span class="o">=</span> <span class="n">death</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">llike</span> <span class="o">=</span> <span class="o">-</span><span class="n">opt_res</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">survivalprob</span><span class="p">[</span><span class="n">survidx</span><span class="p">]))</span>
        <span class="n">wtd_km</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>
        <span class="n">survivalmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">wtd_km</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">llikemax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">wtd_km</span><span class="p">[</span><span class="n">uncensored</span><span class="p">]))</span> <span class="o">+</span> \
          <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">survivalmax</span><span class="p">[</span><span class="n">censored</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">iters</span> <span class="o">==</span> <span class="n">maxiter</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;The EM reached the maximum number of iterations&#39;</span><span class="p">,</span>
                          <span class="n">IterationLimitWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">llike</span> <span class="o">-</span> <span class="n">llikemax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ci_limits_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">param_num</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the difference between the log likelihood for a</span>
<span class="sd">        parameter and some critical value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        b0: float</span>
<span class="sd">            Value of a regression parameter</span>

<span class="sd">        param_num: int</span>
<span class="sd">            Parameter index of b0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_beta</span><span class="p">([</span><span class="n">b0</span><span class="p">],</span> <span class="p">[</span><span class="n">param_num</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">r0</span></div>


<div class="viewcode-block" id="emplikeAFT"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.api.emplikeAFT.html#statsmodels.emplike.aft_el.emplikeAFT">[docs]</a><span class="k">class</span> <span class="nc">emplikeAFT</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Class for estimating and conducting inference in an AFT model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>

<span class="sd">    endog: nx1 array</span>
<span class="sd">        Response variables that are subject to random censoring</span>

<span class="sd">    exog: nxk array</span>
<span class="sd">        Matrix of covariates</span>

<span class="sd">    censors: nx1 array</span>
<span class="sd">        array with entries 0 or 1.  0 indicates a response was</span>
<span class="sd">        censored.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>

<span class="sd">    nobs: float</span>
<span class="sd">        Number of observations</span>

<span class="sd">    endog: array</span>
<span class="sd">        Endog attay</span>

<span class="sd">    exog: array</span>
<span class="sd">        Exogenous variable matrix</span>

<span class="sd">    censors</span>
<span class="sd">        Censors array but sets the max(endog) to uncensored</span>

<span class="sd">    nvar: float</span>
<span class="sd">        Number of exogenous variables</span>

<span class="sd">    uncens_nobs: float</span>
<span class="sd">        Number of uncensored observations</span>

<span class="sd">    uncens_endog: array</span>
<span class="sd">        Uncensored response variables</span>

<span class="sd">    uncens_exog: array</span>
<span class="sd">        Exogenous variables of the uncensored observations</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>

<span class="sd">    params:</span>
<span class="sd">        Fits model parameters</span>

<span class="sd">    test_beta:</span>
<span class="sd">        Tests if beta = b0 for any vector b0.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The data is immediately sorted in order of increasing endogenous</span>
<span class="sd">    variables</span>

<span class="sd">    The last observation is assumed to be uncensored which makes</span>
<span class="sd">    estimation and inference possible.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="emplikeAFT.__init__"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.api.emplikeAFT.__init__.html#statsmodels.emplike.aft_el.emplikeAFT.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">exog</span><span class="p">,</span> <span class="n">censors</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">exog</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">=</span> <span class="n">endog</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog</span> <span class="o">=</span> <span class="n">exog</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">censors</span> <span class="o">=</span> <span class="n">censors</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lexsort</span><span class="p">((</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">censors</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">censors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">censors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">censors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Sort in init, not in function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncens_nobs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">censors</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">censors</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncens_endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uncens_exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">exog</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="p">:]</span></div>


    <span class="k">def</span> <span class="nf">_is_tied</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">censors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Indicated if an observation takes the same value as the next</span>
<span class="sd">        ordered observation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        endog: array</span>
<span class="sd">            Models endogenous variable</span>
<span class="sd">        censors: array</span>
<span class="sd">            arrat indicating a censored array</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        indic_ties: array</span>
<span class="sd">            ties[i]=1 if endog[i]==endog[i+1] and</span>
<span class="sd">            censors[i]=censors[i+1]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">)</span>
        <span class="n">endog_idx</span> <span class="o">=</span> <span class="n">endog</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">==</span> <span class="p">(</span>
            <span class="n">endog</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">censors_idx</span> <span class="o">=</span> <span class="n">censors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">==</span> <span class="p">(</span>
            <span class="n">censors</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">indic_ties</span> <span class="o">=</span> <span class="n">endog_idx</span> <span class="o">*</span> <span class="n">censors_idx</span>  <span class="c1"># Both true</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">(</span><span class="n">indic_ties</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_km_w_ties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tie_indic</span><span class="p">,</span> <span class="n">untied_km</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes KM estimator value at each observation, taking into acocunt</span>
<span class="sd">        ties in the data.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tie_indic: 1d array</span>
<span class="sd">            Indicates if the i&#39;th observation is the same as the ith +1</span>
<span class="sd">        untied_km: 1d array</span>
<span class="sd">            Km estimates at each observation assuming no ties.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Vectorize, even though it is only 1 pass through for any</span>
        <span class="c1"># function call</span>
        <span class="n">num_same</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">idx_nums</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">obs_num</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">tie_indic</span><span class="p">[</span><span class="n">obs_num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obs_num</span><span class="p">)</span>
                <span class="n">num_same</span> <span class="o">=</span> <span class="n">num_same</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">untied_km</span><span class="p">[</span><span class="n">obs_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">untied_km</span><span class="p">[</span><span class="n">obs_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">tie_indic</span><span class="p">[</span><span class="n">obs_num</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">num_same</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">idx_nums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">idx_nums</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">idx_nums</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idx_nums</span><span class="p">)</span>
                <span class="n">untied_km</span><span class="p">[</span><span class="n">idx_nums</span><span class="p">]</span> <span class="o">=</span> <span class="n">untied_km</span><span class="p">[</span><span class="n">idx_nums</span><span class="p">]</span>
                <span class="n">num_same</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">idx_nums</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">untied_km</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_make_km</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endog</span><span class="p">,</span> <span class="n">censors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Computes the Kaplan-Meier estimate for the weights in the AFT model</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        endog: nx1 array</span>
<span class="sd">            Array of response variables</span>
<span class="sd">        censors: nx1 array</span>
<span class="sd">            Censor-indicating variable</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Kaplan Meier estimate for each observation</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This function makes calls to _is_tied and km_w_ties to handle ties in</span>
<span class="sd">        the data.If a censored observation and an uncensored observation has</span>
<span class="sd">        the same value, it is assumed that the uncensored happened first.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobs</span>
        <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="n">nobs</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nobs</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">))</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="p">((</span><span class="n">nobs</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nobs</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">))</span>
        <span class="n">km</span> <span class="o">=</span> <span class="p">(</span><span class="n">num</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">km</span> <span class="o">=</span> <span class="n">km</span> <span class="o">**</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">censors</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">km</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">km</span><span class="p">)</span>  <span class="c1"># If no ties, this is kaplan-meier</span>
        <span class="n">tied</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_tied</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">censors</span><span class="p">)</span>
        <span class="n">wtd_km</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_km_w_ties</span><span class="p">(</span><span class="n">tied</span><span class="p">,</span> <span class="n">km</span><span class="p">)</span>
        <span class="k">return</span>  <span class="p">(</span><span class="n">censors</span> <span class="o">/</span> <span class="n">wtd_km</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nobs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="emplikeAFT.fit"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.api.emplikeAFT.fit.html#statsmodels.emplike.aft_el.emplikeAFT.fit">[docs]</a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Fits an AFT model and returns results instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        None</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Results instance.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        To avoid dividing by zero, max(endog) is assumed to be uncensored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">AFTResults</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="emplikeAFT.predict"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.api.emplikeAFT.predict.html#statsmodels.emplike.aft_el.emplikeAFT.predict">[docs]</a>    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">endog</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">endog</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endog</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="AFTResults"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.aft_el.AFTResults.html#statsmodels.emplike.aft_el.AFTResults">[docs]</a><span class="k">class</span> <span class="nc">AFTResults</span><span class="p">(</span><span class="n">OptAFT</span><span class="p">):</span>
<div class="viewcode-block" id="AFTResults.__init__"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.aft_el.AFTResults.__init__.html#statsmodels.emplike.aft_el.AFTResults.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span></div>

<div class="viewcode-block" id="AFTResults.params"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.aft_el.AFTResults.params.html#statsmodels.emplike.aft_el.AFTResults.params">[docs]</a>    <span class="k">def</span> <span class="nf">params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Fits an AFT model and returns parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>
<span class="sd">        None</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Fitted params</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        To avoid dividing by zero, max(endog) is assumed to be uncensored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">modif_censors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">censors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">modif_censors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">wts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_make_km</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">modif_censors</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">WLS</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">,</span> <span class="n">wts</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="AFTResults.test_beta"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.aft_el.AFTResults.test_beta.html#statsmodels.emplike.aft_el.AFTResults.test_beta">[docs]</a>    <span class="k">def</span> <span class="nf">test_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b0_vals</span><span class="p">,</span> <span class="n">param_nums</span><span class="p">,</span> <span class="n">ftol</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                  <span class="n">print_weights</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the profile log likelihood for regression parameters</span>
<span class="sd">        &#39;param_num&#39; at &#39;b0_vals.&#39;</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        b0_vals: list</span>
<span class="sd">            The value of parameters to be tested</span>

<span class="sd">        param_num: list</span>
<span class="sd">            Which parameters to be tested</span>

<span class="sd">        maxiter: int, optional</span>
<span class="sd">            How many iterations to use in the EM algorithm.  Default is 30</span>

<span class="sd">        ftol: float, optional</span>
<span class="sd">            The function tolerance for the EM optimization.</span>
<span class="sd">            Default is 10&#39;&#39;**&#39;&#39;-5</span>

<span class="sd">        print_weights: bool</span>
<span class="sd">            If true, returns the weights tate maximize the profile</span>
<span class="sd">            log likelihood. Default is False</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        test_results: tuple</span>
<span class="sd">            The log-likelihood and p-pvalue of the test.</span>

<span class="sd">        Notes</span>
<span class="sd">        ----</span>

<span class="sd">        The function will warn if the EM reaches the maxiter.  However, when</span>
<span class="sd">        optimizing over nuisance parameters, it is possible to reach a</span>
<span class="sd">        maximum number of inner iterations for a specific value for the</span>
<span class="sd">        nuisance parameters while the resultsof the function are still valid.</span>
<span class="sd">        This usually occurs when the optimization over the nuisance parameters</span>
<span class="sd">        selects paramater values that yield a log-likihood ratio close to</span>
<span class="sd">        infinity.</span>

<span class="sd">        Examples</span>
<span class="sd">        -------</span>

<span class="sd">        import statsmodels.api as sm</span>
<span class="sd">        import numpy as np</span>

<span class="sd">        # Test parameter is .05 in one regressor no intercept model</span>
<span class="sd">        data=sm.datasets.heart.load()</span>
<span class="sd">        y = np.log10(data.endog)</span>
<span class="sd">        x = data.exog</span>
<span class="sd">        cens = data.censors</span>
<span class="sd">        model = sm.emplike.emplikeAFT(y, x, cens)</span>
<span class="sd">        res=model.test_beta([0], [0])</span>
<span class="sd">        &gt;&gt;&gt;res</span>
<span class="sd">        &gt;&gt;&gt;(1.4657739632606308, 0.22601365256959183)</span>

<span class="sd">        #Test slope is 0 in  model with intercept</span>

<span class="sd">        data=sm.datasets.heart.load()</span>
<span class="sd">        y = np.log10(data.endog)</span>
<span class="sd">        x = data.exog</span>
<span class="sd">        cens = data.censors</span>
<span class="sd">        model = sm.emplike.emplikeAFT(y, sm.add_constant(x), cens)</span>
<span class="sd">        res=model.test_beta([0], [1])</span>
<span class="sd">        &gt;&gt;&gt;res</span>
<span class="sd">        &gt;&gt;&gt;(4.623487775078047, 0.031537049752572731)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">censors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">censors</span>
        <span class="n">endog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">endog</span>
        <span class="n">exog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span>
        <span class="n">uncensored</span> <span class="o">=</span> <span class="p">(</span><span class="n">censors</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">censored</span> <span class="o">=</span> <span class="p">(</span><span class="n">censors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">uncens_endog</span> <span class="o">=</span> <span class="n">endog</span><span class="p">[</span><span class="n">uncensored</span><span class="p">]</span>
        <span class="n">uncens_exog</span> <span class="o">=</span> <span class="n">exog</span><span class="p">[</span><span class="n">uncensored</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">reg_model</span> <span class="o">=</span> <span class="n">OLS</span><span class="p">(</span><span class="n">uncens_endog</span><span class="p">,</span> <span class="n">uncens_exog</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">llr</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="n">new_weights</span> <span class="o">=</span> <span class="n">reg_model</span><span class="o">.</span><span class="n">el_test</span><span class="p">(</span><span class="n">b0_vals</span><span class="p">,</span> <span class="n">param_nums</span><span class="p">,</span>
                                      <span class="n">return_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Needs to be changed</span>
        <span class="n">km</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_make_km</span><span class="p">(</span><span class="n">endog</span><span class="p">,</span> <span class="n">censors</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># when merged</span>
        <span class="n">uncens_nobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">uncens_nobs</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">uncens_nobs</span><span class="p">)</span>
        <span class="c1"># Step 0 ^</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">()</span>
        <span class="n">survidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">censors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">survidx</span> <span class="o">=</span> <span class="n">survidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">survidx</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">numcensbelow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">censors</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_nums</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">llr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_EM_test</span><span class="p">([],</span> <span class="n">F</span><span class="o">=</span><span class="n">F</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
                                      <span class="n">param_nums</span><span class="o">=</span><span class="n">param_nums</span><span class="p">,</span>
                                <span class="n">b0_vals</span><span class="o">=</span><span class="n">b0_vals</span><span class="p">,</span> <span class="n">survidx</span><span class="o">=</span><span class="n">survidx</span><span class="p">,</span>
                             <span class="n">uncens_nobs</span><span class="o">=</span><span class="n">uncens_nobs</span><span class="p">,</span>
                             <span class="n">numcensbelow</span><span class="o">=</span><span class="n">numcensbelow</span><span class="p">,</span> <span class="n">km</span><span class="o">=</span><span class="n">km</span><span class="p">,</span>
                             <span class="n">uncensored</span><span class="o">=</span><span class="n">uncensored</span><span class="p">,</span> <span class="n">censored</span><span class="o">=</span><span class="n">censored</span><span class="p">,</span>
                             <span class="n">ftol</span><span class="o">=</span><span class="n">ftol</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">llr</span><span class="p">,</span> <span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">llr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nvar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param_nums</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_EM_test</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span>
                                   <span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">param_nums</span><span class="p">,</span> <span class="n">b0_vals</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">survidx</span><span class="p">,</span>
                                    <span class="n">uncens_nobs</span><span class="p">,</span> <span class="n">numcensbelow</span><span class="p">,</span> <span class="n">km</span><span class="p">,</span> <span class="n">uncensored</span><span class="p">,</span>
                                    <span class="n">censored</span><span class="p">,</span> <span class="n">maxiter</span><span class="p">,</span> <span class="n">ftol</span><span class="p">),</span> <span class="n">full_output</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                <span class="n">llr</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">llr</span><span class="p">,</span> <span class="n">chi2</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">llr</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">param_nums</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">LinAlgError</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="AFTResults.ci_beta"><a class="viewcode-back" href="../../../generated/generated/statsmodels.emplike.aft_el.AFTResults.ci_beta.html#statsmodels.emplike.aft_el.AFTResults.ci_beta">[docs]</a>    <span class="k">def</span> <span class="nf">ci_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_num</span><span class="p">,</span> <span class="n">beta_high</span><span class="p">,</span> <span class="n">beta_low</span><span class="p">,</span> <span class="n">sig</span><span class="o">=.</span><span class="mi">05</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the confidence interval for a regression</span>
<span class="sd">        parameter in the AFT model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ---------</span>

<span class="sd">        param_num: int</span>
<span class="sd">            Parameter number of interest</span>

<span class="sd">        beta_high: float</span>
<span class="sd">            Upper bound for the confidence interval</span>

<span class="sd">        beta_low:</span>
<span class="sd">            Lower bound for the confidence interval</span>

<span class="sd">        sig: float, optional</span>
<span class="sd">            Significance level.  Default is .05</span>

<span class="sd">        Notes</span>
<span class="sd">        ----</span>
<span class="sd">        If the function returns f(a) and f(b) must have different signs,</span>
<span class="sd">        consider widening the search area by adjusting beta_low and</span>
<span class="sd">        beta_high.</span>

<span class="sd">        Also note that this process is computational intensive.  There</span>
<span class="sd">        are 4 levels of optimization/solving.  From outer to inner:</span>

<span class="sd">        1) Solving so that llr-critical value = 0</span>
<span class="sd">        2) maximizing over nuisance parameters</span>
<span class="sd">        3) Using  EM at each value of nuisamce parameters</span>
<span class="sd">        4) Using the _modified_Newton optimizer at each iteration</span>
<span class="sd">           of the EM algorithm.</span>

<span class="sd">        Also, for very unlikely nuisance parameters, it is possible for</span>
<span class="sd">        the EM algorithm to not converge.  This is not an indicator</span>
<span class="sd">        that the solver did not find the correct solution.  It just means</span>
<span class="sd">        for a specific iteration of the nuisance parameters, the optimizer</span>
<span class="sd">        was unable to converge.</span>

<span class="sd">        If the user desires to verify the success of the optimization,</span>
<span class="sd">        it is recommended to test the limits using test_beta.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r0</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sig</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ll</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ci_limits_beta</span><span class="p">,</span> <span class="n">beta_low</span><span class="p">,</span>
                             <span class="n">params</span><span class="p">[</span><span class="n">param_num</span><span class="p">],</span> <span class="p">(</span><span class="n">param_num</span><span class="p">))</span>
        <span class="n">ul</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ci_limits_beta</span><span class="p">,</span>
                             <span class="n">params</span><span class="p">[</span><span class="n">param_num</span><span class="p">],</span> <span class="n">beta_high</span><span class="p">,</span> <span class="p">(</span><span class="n">param_num</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ll</span><span class="p">,</span> <span class="n">ul</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>